@echo off
chcp 65001 >nul
echo æ­£åœ¨åˆ›å»ºå–µå’’Â·AI Spellbooké¡¹ç›®ç»“æ„...

REM åˆ›å»ºä¸»ç›®å½•ç»“æ„
@REM mkdir pormula 2>nul
@REM cd pormula

REM åˆ›å»ºå­ç›®å½•ç»“æ„
mkdir app 2>nul
mkdir app\web 2>nul
mkdir app\web\css 2>nul
mkdir app\web\js 2>nul
mkdir app\web\assets 2>nul
mkdir app\backend 2>nul
mkdir app\backend\routes 2>nul
mkdir app\backend\data 2>nul
mkdir app\backend\utils 2>nul
mkdir app\config 2>nul

echo ç›®å½•ç»“æ„åˆ›å»ºå®Œæˆï¼Œæ­£åœ¨ç”Ÿæˆæ–‡ä»¶...

REM åˆ›å»º lzc-build.yml
(
echo name: å–µå’’Â·AI Spellbook
echo version: 1.0.0
echo description: ä»¥è¡¨è¾¾å…¬å¼çš„å½¢å¼ç»„åˆå…³é”®è¯å¥ç‰‡æ®µï¼Œå½¢æˆæ›´å¥½çš„æç¤ºè¯
echo.
echo buildscript: ^|
echo   cd app/backend
echo   npm install --production
echo   cd ../..
echo.
echo contentdir: app
echo outputfile: pormula.lpk
) > lzc-build.yml

REM åˆ›å»º lzc-manifest.yml
(
echo name: å–µå’’Â·AI Spellbook
echo package: cloud.lazycat.app.aispellbook
echo version: 1.0.0
echo description: ä»¥è¡¨è¾¾å…¬å¼çš„å½¢å¼ç»„åˆå…³é”®è¯å¥ç‰‡æ®µï¼Œå½¢æˆæ›´å¥½çš„æç¤ºè¯
echo author: LazyCAT Team
echo.
echo application:
echo   subdomain: aispellbook
echo   workdir: /lzcapp/pkg/content/
echo.  
echo   routes:
echo     # é™æ€æ–‡ä»¶è·¯ç”±
echo     - /=file:///lzcapp/pkg/content/web/
echo     - /css/=file:///lzcapp/pkg/content/web/css/
echo     - /js/=file:///lzcapp/pkg/content/web/js/
echo     - /assets/=file:///lzcapp/pkg/content/web/assets/
echo.    
echo   upstreams:
echo     # APIåç«¯æœåŠ¡
echo     - location: /api/
echo       workdir: /lzcapp/pkg/content/backend/
echo       backend: http://127.0.0.1:3000/api/
echo       backend_launch_command: ^|
echo         cd /lzcapp/pkg/content/backend
echo         apk update
echo         apk add nodejs npm
echo         npm install
echo         node server.js
) > lzc-manifest.yml

REM åˆ›å»º app/web/index.html
(
echo ^<!DOCTYPE html^>
echo ^<html lang="zh-CN"^>
echo ^<head^>
echo     ^<meta charset="UTF-8"^>
echo     ^<meta name="viewport" content="width=device-width, initial-scale=1.0"^>
echo     ^<title^>å–µå’’Â·AI Spellbook^</title^>
echo     ^<link rel="stylesheet" href="css/style.css"^>
echo ^</head^>
echo ^<body^>
echo     ^<div class="container"^>
echo         ^<header class="header"^>
echo             ^<div class="logo"^>
echo                 ^<h1^>ğŸ± å–µå’’Â·AI Spellbook^</h1^>
echo                 ^<p^>ä»¥è¡¨è¾¾å…¬å¼çš„å½¢å¼ç»„åˆå…³é”®è¯å¥ç‰‡æ®µï¼Œå½¢æˆæ›´å¥½çš„æç¤ºè¯^</p^>
echo             ^</div^>
echo         ^</header^>
echo.
echo         ^<main class="main-content"^>
echo             ^<div class="formula-builder"^>
echo                 ^<h2^>å…¬å¼æ„å»ºå™¨^</h2^>
echo                 ^<div class="formula-input"^>
echo                     ^<input type="text" id="formulaName" placeholder="è¾“å…¥å…¬å¼åç§°..." class="formula-name-input"^>
echo                     ^<textarea id="formulaContent" placeholder="åœ¨æ­¤è¾“å…¥æ‚¨çš„æç¤ºè¯å…¬å¼..." class="edit-textarea"^>^</textarea^>
echo                     ^<div class="edit-actions"^>
echo                         ^<button onclick="saveFormula(^)" class="btn btn-primary"^>ä¿å­˜å…¬å¼^</button^>
echo                         ^<button onclick="clearFormula(^)" class="btn btn-secondary"^>æ¸…ç©º^</button^>
echo                     ^</div^>
echo                 ^</div^>
echo             ^</div^>
echo.
echo             ^<div class="formula-list"^>
echo                 ^<h2^>å·²ä¿å­˜çš„å…¬å¼^</h2^>
echo                 ^<div id="formulaContainer" class="formula-container"^>
echo                     ^<!-- å…¬å¼åˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ --^>
echo                 ^</div^>
echo             ^</div^>
echo         ^</main^>
echo     ^</div^>
echo.
echo     ^<script src="js/minidb.js"^>^</script^>
echo     ^<script src="js/app.js"^>^</script^>
echo ^</body^>
echo ^</html^>
) > app\web\index.html

REM åˆ›å»º app/web/test.html
(
echo ^<!DOCTYPE html^>
echo ^<html lang="zh-CN"^>
echo ^<head^>
echo     ^<meta charset="UTF-8"^>
echo     ^<meta name="viewport" content="width=device-width, initial-scale=1.0"^>
echo     ^<title^>æµ‹è¯•é¡µé¢ - å–µå’’Â·AI Spellbook^</title^>
echo     ^<link rel="stylesheet" href="css/style.css"^>
echo ^</head^>
echo ^<body^>
echo     ^<div class="container"^>
echo         ^<header class="header"^>
echo             ^<h1^>ğŸ§ª æµ‹è¯•é¡µé¢^</h1^>
echo             ^<a href="index.html" class="btn btn-secondary"^>è¿”å›ä¸»é¡µ^</a^>
echo         ^</header^>
echo.
echo         ^<main class="main-content"^>
echo             ^<div class="test-section"^>
echo                 ^<h2^>API æµ‹è¯•^</h2^>
echo                 ^<button onclick="testAPI(^)" class="btn btn-primary"^>æµ‹è¯• API è¿æ¥^</button^>
echo                 ^<div id="testResult" class="test-result"^>^</div^>
echo             ^</div^>
echo.
echo             ^<div class="test-section"^>
echo                 ^<h2^>æ•°æ®åº“æµ‹è¯•^</h2^>
echo                 ^<button onclick="testDatabase(^)" class="btn btn-primary"^>æµ‹è¯•æ•°æ®åº“è¿æ¥^</button^>
echo                 ^<div id="dbTestResult" class="test-result"^>^</div^>
echo             ^</div^>
echo         ^</main^>
echo     ^</div^>
echo.
echo     ^<script src="js/test.js"^>^</script^>
echo ^</body^>
echo ^</html^>
) > app\web\test.html

REM åˆ›å»º app/web/css/style.css
(
echo /* å–µå’’Â·AI Spellbook ä¸»æ ·å¼æ–‡ä»¶ */
echo.
echo /* CSS å˜é‡å®šä¹‰ */
echo :root {
echo   --primary-color: #00aabb;
echo   --secondary-color: #ff6b6b;
echo   --accent-color: #4ecdc4;
echo   --success-color: #51cf66;
echo   --warning-color: #ff9800;
echo   --error-color: #ff5252;
echo   --bg-primary: #1a1a1a;
echo   --bg-secondary: #2d2d2d;
echo   --bg-dark: #0f0f0f;
echo   --bg-light: #3a3a3a;
echo   --card-bg: #252525;
echo   --text-primary: #ffffff;
echo   --text-secondary: #b0b0b0;
echo   --text-muted: #808080;
echo   --border-color: #404040;
echo   --border-radius: 8px;
echo   --spacing-xs: 4px;
echo   --spacing-sm: 8px;
echo   --spacing-md: 16px;
echo   --spacing-lg: 24px;
echo   --spacing-xl: 32px;
echo   --font-family: 'Microsoft YaHei', 'PingFang SC', 'Helvetica Neue', Arial, sans-serif;
echo   --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.3^);
echo   --shadow-md: 0 4px 8px rgba(0, 0, 0, 0.4^);
echo   --shadow-lg: 0 8px 16px rgba(0, 0, 0, 0.5^);
echo }
echo.
echo /* åŸºç¡€é‡ç½® */
echo * {
echo   margin: 0;
echo   padding: 0;
echo   box-sizing: border-box;
echo }
echo.
echo body {
echo   font-family: var(--font-family^);
echo   background-color: var(--bg-primary^);
echo   color: var(--text-primary^);
echo   line-height: 1.6;
echo   min-height: 100vh;
echo }
echo.
echo /* å®¹å™¨å¸ƒå±€ */
echo .container {
echo   max-width: 1200px;
echo   margin: 0 auto;
echo   padding: var(--spacing-md^);
echo }
echo.
echo /* å¤´éƒ¨æ ·å¼ */
echo .header {
echo   text-align: center;
echo   margin-bottom: var(--spacing-xl^);
echo   padding: var(--spacing-lg^);
echo   background: linear-gradient(135deg, var(--primary-color^), var(--accent-color^)^);
echo   border-radius: var(--border-radius^);
echo   box-shadow: var(--shadow-md^);
echo }
echo.
echo .header h1 {
echo   font-size: 2.5rem;
echo   margin-bottom: var(--spacing-sm^);
echo   text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3^);
echo }
echo.
echo .header p {
echo   font-size: 1.1rem;
echo   opacity: 0.9;
echo }
echo.
echo /* ä¸»å†…å®¹åŒºåŸŸ */
echo .main-content {
echo   display: grid;
echo   grid-template-columns: 1fr 1fr;
echo   gap: var(--spacing-xl^);
echo   margin-bottom: var(--spacing-xl^);
echo }
echo.
echo @media (max-width: 768px^) {
echo   .main-content {
echo     grid-template-columns: 1fr;
echo   }
echo }
echo.
echo /* å¡ç‰‡æ ·å¼ */
echo .formula-builder,
echo .formula-list {
echo   background-color: var(--card-bg^);
echo   border-radius: var(--border-radius^);
echo   padding: var(--spacing-lg^);
echo   box-shadow: var(--shadow-md^);
echo   border: 1px solid var(--border-color^);
echo }
echo.
echo .formula-builder h2,
echo .formula-list h2 {
echo   color: var(--primary-color^);
echo   margin-bottom: var(--spacing-md^);
echo   font-size: 1.5rem;
echo   border-bottom: 2px solid var(--primary-color^);
echo   padding-bottom: var(--spacing-sm^);
echo }
echo.
echo /* æŒ‰é’®æ ·å¼ */
echo .btn {
echo   padding: var(--spacing-sm^) var(--spacing-md^);
echo   border: none;
echo   border-radius: var(--border-radius^);
echo   cursor: pointer;
echo   font-size: 0.9rem;
echo   font-weight: 500;
echo   transition: all 0.3s ease;
echo   text-decoration: none;
echo   display: inline-block;
echo   text-align: center;
echo }
echo.
echo .btn-primary {
echo   background-color: var(--primary-color^);
echo   color: white;
echo }
echo.
echo .btn-primary:hover {
echo   background-color: #008a99;
echo   transform: translateY(-2px^);
echo   box-shadow: var(--shadow-md^);
echo }
echo.
echo .btn-secondary {
echo   background-color: var(--bg-light^);
echo   color: var(--text-primary^);
echo   border: 1px solid var(--border-color^);
echo }
echo.
echo .btn-secondary:hover {
echo   background-color: var(--bg-secondary^);
echo   transform: translateY(-2px^);
echo }
echo.
echo /* è¡¨å•å…ƒç´  */
echo .formula-input {
echo   display: flex;
echo   flex-direction: column;
echo   gap: var(--spacing-md^);
echo }
echo.
echo .formula-name-input {
echo   padding: var(--spacing-sm^);
echo   background-color: var(--bg-dark^);
echo   border: 1px solid var(--border-color^);
echo   border-radius: var(--border-radius^);
echo   color: var(--text-primary^);
echo   font-size: 0.9rem;
echo }
echo.
echo .formula-name-input:focus {
echo   outline: none;
echo   border-color: var(--primary-color^);
echo   box-shadow: 0 0 0 2px rgba(0, 170, 187, 0.2^);
echo }
echo.
echo .edit-textarea {
echo   width: 100%;
echo   min-height: 200px;
echo   padding: var(--spacing-md^);
echo   background-color: var(--bg-dark^);
echo   border: 1px solid var(--border-color^);
echo   border-radius: var(--border-radius^);
echo   color: var(--text-primary^);
echo   font-family: monospace;
echo   font-size: 0.9rem;
echo   line-height: 1.5;
echo   resize: vertical;
echo }
echo.
echo .edit-textarea:focus {
echo   outline: none;
echo   border-color: var(--primary-color^);
echo   box-shadow: 0 0 0 2px rgba(0, 170, 187, 0.2^);
echo }
echo.
echo .edit-actions {
echo   display: flex;
echo   gap: var(--spacing-sm^);
echo   align-items: center;
echo }
echo.
echo /* å…¬å¼å®¹å™¨ */
echo .formula-container {
echo   display: flex;
echo   flex-direction: column;
echo   gap: var(--spacing-md^);
echo }
echo.
echo .formula-item {
echo   background-color: var(--bg-dark^);
echo   border: 1px solid var(--border-color^);
echo   border-radius: var(--border-radius^);
echo   padding: var(--spacing-md^);
echo   transition: all 0.3s ease;
echo }
echo.
echo .formula-item:hover {
echo   border-color: var(--primary-color^);
echo   box-shadow: var(--shadow-sm^);
echo }
echo.
echo .formula-header {
echo   display: flex;
echo   justify-content: space-between;
echo   align-items: center;
echo   margin-bottom: var(--spacing-sm^);
echo }
echo.
echo .formula-name {
echo   font-weight: bold;
echo   color: var(--accent-color^);
echo   font-size: 1.1rem;
echo }
echo.
echo .formula-actions {
echo   display: flex;
echo   gap: var(--spacing-xs^);
echo }
echo.
echo .formula-content {
echo   background-color: var(--bg-secondary^);
echo   padding: var(--spacing-sm^);
echo   border-radius: var(--border-radius^);
echo   font-family: monospace;
echo   font-size: 0.85rem;
echo   line-height: 1.4;
echo   white-space: pre-wrap;
echo   word-break: break-word;
echo }
echo.
echo /* æµ‹è¯•é¡µé¢æ ·å¼ */
echo .test-section {
echo   background-color: var(--card-bg^);
echo   border-radius: var(--border-radius^);
echo   padding: var(--spacing-lg^);
echo   margin-bottom: var(--spacing-md^);
echo   box-shadow: var(--shadow-md^);
echo }
echo.
echo .test-result {
echo   margin-top: var(--spacing-md^);
echo   padding: var(--spacing-md^);
echo   background-color: var(--bg-dark^);
echo   border-radius: var(--border-radius^);
echo   border: 1px solid var(--border-color^);
echo   font-family: monospace;
echo   font-size: 0.9rem;
echo   white-space: pre-wrap;
echo }
echo.
echo /* æ»šåŠ¨æ¡æ ·å¼ */
echo ::-webkit-scrollbar {
echo   width: 8px;
echo   height: 8px;
echo }
echo.
echo ::-webkit-scrollbar-track {
echo   background: var(--bg-dark^);
echo   border-radius: 4px;
echo }
echo.
echo ::-webkit-scrollbar-thumb {
echo   background: var(--border-color^);
echo   border-radius: 4px;
echo }
echo.
echo ::-webkit-scrollbar-thumb:hover {
echo   background: var(--text-muted^);
echo }
) > app\web\css\style.css

REM åˆ›å»º app/web/js/minidb.js
(
echo /**
echo  * MiniDB - è½»é‡çº§æœ¬åœ°å­˜å‚¨å°è£…
echo  * æä¾›ç®€å•çš„æ•°æ®å­˜å‚¨å’Œæ£€ç´¢åŠŸèƒ½
echo  */
echo class MiniDB {
echo     constructor(dbName = 'minidb'^) {
echo         this.dbName = dbName;
echo         this.prefix = `${dbName}_`;
echo     }
echo.
echo     /**
echo      * ä¿å­˜æ•°æ®åˆ°æœ¬åœ°å­˜å‚¨
echo      * @param {string} key - æ•°æ®é”®å
echo      * @param {any} value - è¦ä¿å­˜çš„æ•°æ®
echo      */
echo     set(key, value^) {
echo         try {
echo             const serializedValue = JSON.stringify(value^);
echo             localStorage.setItem(this.prefix + key, serializedValue^);
echo             return true;
echo         } catch (error^) {
echo             console.error('MiniDB ä¿å­˜æ•°æ®å¤±è´¥:', error^);
echo             return false;
echo         }
echo     }
echo.
echo     /**
echo      * ä»æœ¬åœ°å­˜å‚¨è·å–æ•°æ®
echo      * @param {string} key - æ•°æ®é”®å
echo      * @param {any} defaultValue - é»˜è®¤å€¼
echo      * @returns {any} è·å–çš„æ•°æ®æˆ–é»˜è®¤å€¼
echo      */
echo     get(key, defaultValue = null^) {
echo         try {
echo             const item = localStorage.getItem(this.prefix + key^);
echo             return item ? JSON.parse(item^) : defaultValue;
echo         } catch (error^) {
echo             console.error('MiniDB è·å–æ•°æ®å¤±è´¥:', error^);
echo             return defaultValue;
echo         }
echo     }
echo.
echo     /**
echo      * åˆ é™¤æŒ‡å®šé”®çš„æ•°æ®
echo      * @param {string} key - è¦åˆ é™¤çš„æ•°æ®é”®å
echo      */
echo     remove(key^) {
echo         localStorage.removeItem(this.prefix + key^);
echo     }
echo.
echo     /**
echo      * æ¸…ç©ºæ‰€æœ‰æ•°æ®
echo      */
echo     clear(^) {
echo         const keys = Object.keys(localStorage^);
echo         keys.forEach(key =^> {
echo             if (key.startsWith(this.prefix^)^) {
echo                 localStorage.removeItem(key^);
echo             }
echo         }^);
echo     }
echo.
echo     /**
echo      * è·å–æ‰€æœ‰é”®å
echo      * @returns {Array} æ‰€æœ‰é”®åæ•°ç»„
echo      */
echo     keys(^) {
echo         const keys = Object.keys(localStorage^);
echo         return keys
echo             .filter(key =^> key.startsWith(this.prefix^)^)
echo             .map(key =^> key.substring(this.prefix.length^)^);
echo     }
echo.
echo     /**
echo      * æ£€æŸ¥æ˜¯å¦å­˜åœ¨æŒ‡å®šé”®
echo      * @param {string} key - è¦æ£€æŸ¥çš„é”®å
echo      * @returns {boolean} æ˜¯å¦å­˜åœ¨
echo      */
echo     has(key^) {
echo         return localStorage.getItem(this.prefix + key^) !== null;
echo     }
echo }
echo.
echo // å¯¼å‡º MiniDB ç±»
echo window.MiniDB = MiniDB;
) > app\web\js\minidb.js

REM åˆ›å»º app/web/js/app.js
(
echo /**
echo  * å–µå’’Â·AI Spellbook ä¸»åº”ç”¨é€»è¾‘
echo  */
echo.
echo // åˆå§‹åŒ–æ•°æ®åº“
echo const db = new MiniDB('aispellbook'^);
echo.
echo // åº”ç”¨çŠ¶æ€
echo let formulas = [];
echo let currentEditingId = null;
echo.
echo /**
echo  * åº”ç”¨åˆå§‹åŒ–
echo  */
echo function initApp(^) {
echo     console.log('ğŸ± å–µå’’Â·AI Spellbook å¯åŠ¨ä¸­...'^);
echo     loadFormulas(^);
echo     renderFormulas(^);
echo     setupEventListeners(^);
echo     console.log('âœ… åº”ç”¨åˆå§‹åŒ–å®Œæˆ'^);
echo }
echo.
echo /**
echo  * è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
echo  */
echo function setupEventListeners(^) {
echo     // ç›‘å¬å›è½¦é”®å¿«é€Ÿä¿å­˜
echo     document.getElementById('formulaName'^).addEventListener('keypress', function(e^) {
echo         if (e.key === 'Enter'^) {
echo             saveFormula(^);
echo         }
echo     }^);
echo.
echo     // ç›‘å¬ Ctrl+S å¿«é€Ÿä¿å­˜
echo     document.addEventListener('keydown', function(e^) {
echo         if (e.ctrlKey ^&^& e.key === 's'^) {
echo             e.preventDefault(^);
echo             saveFormula(^);
echo         }
echo     }^);
echo }
echo.
echo /**
echo  * ä»æœ¬åœ°å­˜å‚¨åŠ è½½å…¬å¼
echo  */
echo function loadFormulas(^) {
echo     formulas = db.get('formulas', []^);
echo     console.log(`ğŸ“š åŠ è½½äº† ${formulas.length} ä¸ªå…¬å¼`^);
echo }
echo.
echo /**
echo  * ä¿å­˜å…¬å¼åˆ°æœ¬åœ°å­˜å‚¨
echo  */
echo function saveFormulasToStorage(^) {
echo     db.set('formulas', formulas^);
echo }
echo.
echo /**
echo  * ä¿å­˜æ–°å…¬å¼æˆ–æ›´æ–°ç°æœ‰å…¬å¼
echo  */
echo function saveFormula(^) {
echo     const nameInput = document.getElementById('formulaName'^);
echo     const contentInput = document.getElementById('formulaContent'^);
echo.
echo     const name = nameInput.value.trim(^);
echo     const content = contentInput.value.trim(^);
echo.
echo     if (!name^) {
echo         alert('è¯·è¾“å…¥å…¬å¼åç§°ï¼'^);
echo         nameInput.focus(^);
echo         return;
echo     }
echo.
echo     if (!content^) {
echo         alert('è¯·è¾“å…¥å…¬å¼å†…å®¹ï¼'^);
echo         contentInput.focus(^);
echo         return;
echo     }
echo.
echo     const now = new Date(^).toISOString(^);
echo.
echo     if (currentEditingId^) {
echo         // æ›´æ–°ç°æœ‰å…¬å¼
echo         const index = formulas.findIndex(f =^> f.id === currentEditingId^);
echo         if (index !== -1^) {
echo             formulas[index] = {
echo                 ...formulas[index],
echo                 name,
echo                 content,
echo                 updatedAt: now
echo             };
echo             console.log(`ğŸ“ æ›´æ–°å…¬å¼: ${name}`^);
echo         }
echo         currentEditingId = null;
echo     } else {
echo         // åˆ›å»ºæ–°å…¬å¼
echo         const newFormula = {
echo             id: generateId(^),
echo             name,
echo             content,
echo             createdAt: now,
echo             updatedAt: now
echo         };
echo         formulas.unshift(newFormula^);
echo         console.log(`âœ¨ åˆ›å»ºæ–°å…¬å¼: ${name}`^);
echo     }
echo.
echo     saveFormulasToStorage(^);
echo     clearFormula(^);
echo     renderFormulas(^);
echo     showNotification('å…¬å¼ä¿å­˜æˆåŠŸï¼', 'success'^);
echo }
echo.
echo /**
echo  * æ¸…ç©ºè¡¨å•
echo  */
echo function clearFormula(^) {
echo     document.getElementById('formulaName'^).value = '';
echo     document.getElementById('formulaContent'^).value = '';
echo     currentEditingId = null;
echo     console.log('ğŸ§¹ è¡¨å•å·²æ¸…ç©º'^);
echo }
echo.
echo /**
echo  * ç¼–è¾‘å…¬å¼
echo  */
echo function editFormula(id^) {
echo     const formula = formulas.find(f =^> f.id === id^);
echo     if (!formula^) return;
echo.
echo     document.getElementById('formulaName'^).value = formula.name;
echo     document.getElementById('formulaContent'^).value = formula.content;
echo     currentEditingId = id;
echo.
echo     // æ»šåŠ¨åˆ°ç¼–è¾‘åŒºåŸŸ
echo     document.querySelector('.formula-builder'^).scrollIntoView({ behavior: 'smooth' }^);
echo     console.log(`âœï¸ ç¼–è¾‘å…¬å¼: ${formula.name}`^);
echo }
echo.
echo /**
echo  * åˆ é™¤å…¬å¼
echo  */
echo function deleteFormula(id^) {
echo     const formula = formulas.find(f =^> f.id === id^);
echo     if (!formula^) return;
echo.
echo     if (confirm(`ç¡®å®šè¦åˆ é™¤å…¬å¼ "${formula.name}" å—ï¼Ÿ`^)^) {
echo         formulas = formulas.filter(f =^> f.id !== id^);
echo         saveFormulasToStorage(^);
echo         renderFormulas(^);
echo         console.log(`ğŸ—‘ï¸ åˆ é™¤å…¬å¼: ${formula.name}`^);
echo         showNotification('å…¬å¼åˆ é™¤æˆåŠŸï¼', 'success'^);
echo     }
echo }
echo.
echo /**
echo  * å¤åˆ¶å…¬å¼å†…å®¹åˆ°å‰ªè´´æ¿
echo  */
echo async function copyFormula(id^) {
echo     const formula = formulas.find(f =^> f.id === id^);
echo     if (!formula^) return;
echo.
echo     try {
echo         await navigator.clipboard.writeText(formula.content^);
echo         console.log(`ğŸ“‹ å¤åˆ¶å…¬å¼: ${formula.name}`^);
echo         showNotification('å…¬å¼å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼', 'success'^);
echo     } catch (error^) {
echo         console.error('å¤åˆ¶å¤±è´¥:', error^);
echo         showNotification('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶', 'error'^);
echo     }
echo }
echo.
echo /**
echo  * æ¸²æŸ“å…¬å¼åˆ—è¡¨
echo  */
echo function renderFormulas(^) {
echo     const container = document.getElementById('formulaContainer'^);
echo     
echo     if (formulas.length === 0^) {
echo         container.innerHTML = `
echo             ^<div style="text-align: center; color: var(--text-muted^); padding: var(--spacing-xl^);"^>
echo                 ^<p^>è¿˜æ²¡æœ‰ä¿å­˜ä»»ä½•å…¬å¼^</p^>
echo                 ^<p^>å¼€å§‹åˆ›å»ºæ‚¨çš„ç¬¬ä¸€ä¸ªAIæç¤ºè¯å…¬å¼å§ï¼^</p^>
echo             ^</div^>
echo         `;
echo         return;
echo     }
echo.
echo     container.innerHTML = formulas.map(formula =^> `
echo         ^<div class="formula-item"^>
echo             ^<div class="formula-header"^>
echo                 ^<span class="formula-name"^>${escapeHtml(formula.name^)^}^</span^>
echo                 ^<div class="formula-actions"^>
echo                     ^<button onclick="copyFormula('${formula.id}'^)" class="btn btn-secondary" title="å¤åˆ¶"^>ğŸ“‹^</button^>
echo                     ^<button onclick="editFormula('${formula.id}'^)" class="btn btn-secondary" title="ç¼–è¾‘"^>âœï¸^</button^>
echo                     ^<button onclick="deleteFormula('${formula.id}'^)" class="btn btn-secondary" title="åˆ é™¤"^>ğŸ—‘ï¸^</button^>
echo                 ^</div^>
echo             ^</div^>
echo             ^<div class="formula-content"^>${escapeHtml(formula.content^)^}^</div^>
echo             ^<div style="font-size: 0.8rem; color: var(--text-muted^); margin-top: var(--spacing-sm^);"^>
echo                 åˆ›å»ºæ—¶é—´: ${formatDate(formula.createdAt^)^}
echo                 ${formula.updatedAt !== formula.createdAt ? ` | æ›´æ–°æ—¶é—´: ${formatDate(formula.updatedAt^)^}` : ''}
echo             ^</div^>
echo         ^</div^>
echo     `^).join('''^);
echo }
echo.
echo /**
echo  * ç”Ÿæˆå”¯ä¸€ID
echo  */
echo function generateId(^) {
echo     return Date.now(^).toString(36^) + Math.random(^).toString(36^).substr(2^);
echo }
echo.
echo /**
echo  * è½¬ä¹‰HTMLå­—ç¬¦
echo  */
echo function escapeHtml(text^) {
echo     const div = document.createElement('div'^);
echo     div.textContent = text;
echo     return div.innerHTML;
echo }
echo.
echo /**
echo  * æ ¼å¼åŒ–æ—¥æœŸ
echo  */
echo function formatDate(dateString^) {
echo     const date = new Date(dateString^);
echo     return date.toLocaleString('zh-CN'^);
echo }
echo.
echo /**
echo  * æ˜¾ç¤ºé€šçŸ¥æ¶ˆæ¯
echo  */
echo function showNotification(message, type = 'info'^) {
echo     // ç®€å•çš„é€šçŸ¥å®ç°
echo     const notification = document.createElement('div'^);
echo     notification.textContent = message;
echo     notification.style.cssText = `
echo         position: fixed;
echo         top: 20px;
echo         right: 20px;
echo         padding: 12px 20px;
echo         background-color: ${type === 'success' ? 'var(--success-color^)' : type === 'error' ? 'var(--error-color^)' : 'var(--primary-color^)'^};
echo         color: white;
echo         border-radius: var(--border-radius^);
echo         box-shadow: var(--shadow-md^);
echo         z-index: 1000;
echo         animation: slideIn 0.3s ease;
echo     `;
echo.
echo     document.body.appendChild(notification^);
echo.
echo     setTimeout(^(^) =^> {
echo         notification.style.animation = 'slideOut 0.3s ease';
echo         setTimeout(^(^) =^> {
echo             document.body.removeChild(notification^);
echo         }, 300^);
echo     }, 3000^);
echo }
echo.
echo // æ·»åŠ åŠ¨ç”»æ ·å¼
echo const style = document.createElement('style'^);
echo style.textContent = `
echo     @keyframes slideIn {
echo         from { transform: translateX(100%^); opacity: 0; }
echo         to { transform: translateX(0^); opacity: 1; }
echo     }
echo     @keyframes slideOut {
echo         from { transform: translateX(0^); opacity: 1; }
echo         to { transform: translateX(100%^); opacity: 0; }
echo     }
echo `;
echo document.head.appendChild(style^);
echo.
echo // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–åº”ç”¨
echo document.addEventListener('DOMContentLoaded', initApp^);
) > app\web\js\app.js

REM åˆ›å»º app/web/js/test.js
(
echo /**
echo  * æµ‹è¯•é¡µé¢é€»è¾‘
echo  */
echo.
echo /**
echo  * æµ‹è¯• API è¿æ¥
echo  */
echo async function testAPI(^) {
echo     const resultDiv = document.getElementById('testResult'^);
echo     resultDiv.textContent = 'æ­£åœ¨æµ‹è¯• API è¿æ¥...';
echo.
echo     try {
echo         const response = await fetch('/api/test'^);
echo         const data = await response.json(^);
echo         
echo         resultDiv.innerHTML = `
echo             ^<strong^>API æµ‹è¯•ç»“æœ:^</strong^>
echo             çŠ¶æ€: ${response.ok ? 'âœ… æˆåŠŸ' : 'âŒ å¤±è´¥'}
echo             çŠ¶æ€ç : ${response.status}
echo             å“åº”æ•°æ®: ${JSON.stringify(data, null, 2^)^}
echo         `;
echo     } catch (error^) {
echo         resultDiv.innerHTML = `
echo             ^<strong^>API æµ‹è¯•ç»“æœ:^</strong^>
echo             çŠ¶æ€: âŒ è¿æ¥å¤±è´¥
echo             é”™è¯¯ä¿¡æ¯: ${error.message}
echo         `;
echo     }
echo }
echo.
echo /**
echo  * æµ‹è¯•æ•°æ®åº“è¿æ¥
echo  */
echo async function testDatabase(^) {
echo     const resultDiv = document.getElementById('dbTestResult'^);
echo     resultDiv.textContent = 'æ­£åœ¨æµ‹è¯•æ•°æ®åº“è¿æ¥...';
echo.
echo     try {
echo         const response = await fetch('/api/test/database'^);
echo         const data = await response.json(^);
echo         
echo         resultDiv.innerHTML = `
echo             ^<strong^>æ•°æ®åº“æµ‹è¯•ç»“æœ:^</strong^>
echo             çŠ¶æ€: ${response.ok ? 'âœ… æˆåŠŸ' : 'âŒ å¤±è´¥'}
echo             çŠ¶æ€ç : ${response.status}
echo             å“åº”æ•°æ®: ${JSON.stringify(data, null, 2^)^}
echo         `;
echo     } catch (error^) {
echo         resultDiv.innerHTML = `
echo             ^<strong^>æ•°æ®åº“æµ‹è¯•ç»“æœ:^</strong^>
echo             çŠ¶æ€: âŒ è¿æ¥å¤±è´¥
echo             é”™è¯¯ä¿¡æ¯: ${error.message}
echo         `;
echo     }
echo }
echo.
echo console.log('ğŸ§ª æµ‹è¯•é¡µé¢å·²åŠ è½½'^);
) > app\web\js\test.js

REM åˆ›å»º app/backend/server.js
(
echo /**
echo  * å–µå’’Â·AI Spellbook åç«¯æœåŠ¡å™¨
echo  */
echo.
echo const express = require('express'^);
echo const cors = require('cors'^);
echo const path = require('path'^);
echo.
echo // å¯¼å…¥è·¯ç”±
echo const apiRoutes = require('./routes/api'^);
echo const testRoutes = require('./routes/test'^);
echo.
echo const app = express(^);
echo const PORT = process.env.PORT ^|^| 3000;
echo.
echo // ä¸­é—´ä»¶é…ç½®
echo app.use(cors(^)^);
echo app.use(express.json({ limit: '10mb' }^)^);
echo app.use(express.urlencoded({ extended: true }^)^);
echo.
echo // è¯·æ±‚æ—¥å¿—ä¸­é—´ä»¶
echo app.use(^(req, res, next^) =^> {
echo     console.log(`${new Date(^).toISOString(^)^} - ${req.method} ${req.path}`^);
echo     next(^);
echo }^);
echo.
echo // è·¯ç”±é…ç½®
echo app.use('/api', apiRoutes^);
echo app.use('/api/test', testRoutes^);
echo.
echo // å¥åº·æ£€æŸ¥ç«¯ç‚¹
echo app.get('/health', ^(req, res^) =^> {
echo     res.json({
echo         status: 'healthy',
echo         timestamp: new Date(^).toISOString(^),
echo         uptime: process.uptime(^)
echo     }^);
echo }^);
echo.
echo // é”™è¯¯å¤„ç†ä¸­é—´ä»¶
echo app.use(^(error, req, res, next^) =^> {
echo     console.error('æœåŠ¡å™¨é”™è¯¯:', error^);
echo     res.status(500^).json({
echo         success: false,
echo         message: 'æœåŠ¡å™¨å†…éƒ¨é”™è¯¯',
echo         error: process.env.NODE_ENV === 'development' ? error.message : undefined
echo     }^);
echo }^);
echo.
echo // 404 å¤„ç†
echo app.use(^(req, res^) =^> {
echo     res.status(404^).json({
echo         success: false,
echo         message: 'æ¥å£ä¸å­˜åœ¨'
echo     }^);
echo }^);
echo.
echo // å¯åŠ¨æœåŠ¡å™¨
echo app.listen(PORT, ^(^) =^> {
echo     console.log(`ğŸš€ å–µå’’Â·AI Spellbook åç«¯æœåŠ¡å¯åŠ¨æˆåŠŸï¼`^);
echo     console.log(`ğŸ“¡ æœåŠ¡åœ°å€: http://localhost:${PORT}`^);
echo     console.log(`ğŸ•’ å¯åŠ¨æ—¶é—´: ${new Date(^).toLocaleString('zh-CN'^)^}`^);
echo }^);
echo.
echo // ä¼˜é›…å…³é—­
echo process.on('SIGTERM', ^(^) =^> {
echo     console.log('ğŸ›‘ æ”¶åˆ° SIGTERM ä¿¡å·ï¼Œæ­£åœ¨å…³é—­æœåŠ¡å™¨...'^);
echo     process.exit(0^);
echo }^);
echo.
echo process.on('SIGINT', ^(^) =^> {
echo     console.log('ğŸ›‘ æ”¶åˆ° SIGINT ä¿¡å·ï¼Œæ­£åœ¨å…³é—­æœåŠ¡å™¨...'^);
echo     process.exit(0^);
echo }^);
) > app\backend\server.js

REM åˆ›å»º app/backend/routes/api.js
(
echo /**
echo  * API è·¯ç”±å¤„ç†
echo  */
echo.
echo const express = require('express'^);
echo const router = express.Router(^);
echo.
echo // å¯¼å…¥å·¥å…·å‡½æ•°
echo const { validateData } = require('../utils/dataValidator'^);
echo const { readFile, writeFile } = require('../utils/fileHandler'^);
echo.
echo /**
echo  * è·å–æ‰€æœ‰å…¬å¼
echo  */
echo router.get('/formulas', async ^(req, res^) =^> {
echo     try {
echo         const formulas = await readFile('formulas.json', []^);
echo         res.json({
echo             success: true,
echo             data: formulas,
echo             count: formulas.length
echo         }^);
echo     } catch (error^) {
echo         console.error('è·å–å…¬å¼åˆ—è¡¨å¤±è´¥:', error^);
echo         res.status(500^).json({
echo             success: false,
echo             message: 'è·å–å…¬å¼åˆ—è¡¨å¤±è´¥'
echo         }^);
echo     }
echo }^);
echo.
echo /**
echo  * åˆ›å»ºæ–°å…¬å¼
echo  */
echo router.post('/formulas', async ^(req, res^) =^> {
echo     try {
echo         const { name, content } = req.body;
echo.
echo         // æ•°æ®éªŒè¯
echo         const validation = validateData({ name, content }, {
echo             name: { required: true, type: 'string', minLength: 1 },
echo             content: { required: true, type: 'string', minLength: 1 }
echo         }^);
echo.
echo         if (!validation.isValid^) {
echo             return res.status(400^).json({
echo                 success: false,
echo                 message: 'æ•°æ®éªŒè¯å¤±è´¥',
echo                 errors: validation.errors
echo             }^);
echo         }
echo.
echo         const formulas = await readFile('formulas.json', []^);
echo         
echo         const newFormula = {
echo             id: Date.now(^).toString(36^) + Math.random(^).toString(36^).substr(2^),
echo             name: name.trim(^),
echo             content: content.trim(^),
echo             createdAt: new Date(^).toISOString(^),
echo             updatedAt: new Date(^).toISOString(^)
echo         };
echo.
echo         formulas.unshift(newFormula^);
echo         await writeFile('formulas.json', formulas^);
echo.
echo         res.status(201^).json({
echo             success: true,
echo             message: 'å…¬å¼åˆ›å»ºæˆåŠŸ',
echo             data: newFormula
echo         }^);
echo     } catch (error^) {
echo         console.error('åˆ›å»ºå…¬å¼å¤±è´¥:', error^);
echo         res.status(500^).json({
echo             success: false,
echo             message: 'åˆ›å»ºå…¬å¼å¤±è´¥'
echo         }^);
echo     }
echo }^);
echo.
echo /**
echo  * æ›´æ–°å…¬å¼
echo  */
echo router.put('/formulas/:id', async ^(req, res^) =^> {
echo     try {
echo         const { id } = req.params;
echo         const { name, content } = req.body;
echo.
echo         // æ•°æ®éªŒè¯
echo         const validation = validateData({ name, content }, {
echo             name: { required: true, type: 'string', minLength: 1 },
echo             content: { required: true, type: 'string', minLength: 1 }
echo         }^);
echo.
echo         if (!validation.isValid^) {
echo             return res.status(400^).json({
echo                 success: false,
echo                 message: 'æ•°æ®éªŒè¯å¤±è´¥',
echo                 errors: validation.errors
echo             }^);
echo         }
echo.
echo         const formulas = await readFile('formulas.json', []^);
echo         const index = formulas.findIndex(f =^> f.id === id^);
echo.
echo         if (index === -1^) {
echo             return res.status(404^).json({
echo                 success: false,
echo                 message: 'å…¬å¼ä¸å­˜åœ¨'
echo             }^);
echo         }
echo.
echo         formulas[index] = {
echo             ...formulas[index],
echo             name: name.trim(^),
echo             content: content.trim(^),
echo             updatedAt: new Date(^).toISOString(^)
echo         };
echo.
echo         await writeFile('formulas.json', formulas^);
echo.
echo         res.json({
echo             success: true,
echo             message: 'å…¬å¼æ›´æ–°æˆåŠŸ',
echo             data: formulas[index]
echo         }^);
echo     } catch (error^) {
echo         console.error('æ›´æ–°å…¬å¼å¤±è´¥:', error^);
echo         res.status(500^).json({
echo             success: false,
echo             message: 'æ›´æ–°å…¬å¼å¤±è´¥'
echo         }^);
echo     }
echo }^);
echo.
echo /**
echo  * åˆ é™¤å…¬å¼
echo  */
echo router.delete('/formulas/:id', async ^(req, res^) =^> {
echo     try {
echo         const { id } = req.params;
echo         const formulas = await readFile('formulas.json', []^);
echo         const index = formulas.findIndex(f =^> f.id === id^);
echo.
echo         if (index === -1^) {
echo             return res.status(404^).json({
echo                 success: false,
echo                 message: 'å…¬å¼ä¸å­˜åœ¨'
echo             }^);
echo         }
echo.
echo         const deletedFormula = formulas.splice(index, 1^)[0];
echo         await writeFile('formulas.json', formulas^);
echo.
echo         res.json({
echo             success: true,
echo             message: 'å…¬å¼åˆ é™¤æˆåŠŸ',
echo             data: deletedFormula
echo         }^);
echo     } catch (error^) {
echo         console.error('åˆ é™¤å…¬å¼å¤±è´¥:', error^);
echo         res.status(500^).json({
echo             success: false,
echo             message: 'åˆ é™¤å…¬å¼å¤±è´¥'
echo         }^);
echo     }
echo }^);
echo.
echo module.exports = router;
) > app\backend\routes\api.js

REM åˆ›å»º app/backend/routes/test.js
(
echo /**
echo  * æµ‹è¯•è·¯ç”±
echo  */
echo.
echo const express = require('express'^);
echo const router = express.Router(^);
echo.
echo /**
echo  * API è¿æ¥æµ‹è¯•
echo  */
echo router.get('/', ^(req, res^) =^> {
echo     res.json({
echo         success: true,
echo         message: 'API è¿æ¥æ­£å¸¸',
echo         timestamp: new Date(^).toISOString(^),
echo         server: 'å–µå’’Â·AI Spellbook Backend',
echo         version: '1.0.0'
echo     }^);
echo }^);
echo.
echo /**
echo  * æ•°æ®åº“è¿æ¥æµ‹è¯•
echo  */
echo router.get('/database', async ^(req, res^) =^> {
echo     try {
echo         // è¿™é‡Œå¯ä»¥æ·»åŠ å®é™…çš„æ•°æ®åº“è¿æ¥æµ‹è¯•
echo         // ç›®å‰ä½¿ç”¨æ¨¡æ‹Ÿæµ‹è¯•
echo         const testResult = {
echo             connected: true,
echo             host: 'mysql.cloud.lazycat.app.aispellbook.lzcapp',
echo             port: 3306,
echo             database: 'LAZYCAT',
echo             user: 'LAZYCAT',
echo             timestamp: new Date(^).toISOString(^)
echo         };
echo.
echo         res.json({
echo             success: true,
echo             message: 'æ•°æ®åº“è¿æ¥æ­£å¸¸',
echo             data: testResult
echo         }^);
echo     } catch (error^) {
echo         res.status(500^).json({
echo             success: false,
echo             message: 'æ•°æ®åº“è¿æ¥å¤±è´¥',
echo             error: error.message
echo         }^);
echo     }
echo }^);
echo.
echo /**
echo  * ç³»ç»Ÿä¿¡æ¯æµ‹è¯•
echo  */
echo router.get('/system', ^(req, res^) =^> {
echo     res.json({
echo         success: true,
echo         data: {
echo             nodeVersion: process.version,
echo             platform: process.platform,
echo             arch: process.arch,
echo             uptime: process.uptime(^),
echo             memory: process.memoryUsage(^),
echo             timestamp: new Date(^).toISOString(^)
echo         }
echo     }^);
echo }^);
echo.
echo module.exports = router;
) > app\backend\routes\test.js

REM åˆ›å»º app/backend/data/init-data.json
(
echo [
echo   {
echo     "id": "sample001",
echo     "name": "è§’è‰²æ‰®æ¼”å…¬å¼",
echo     "content": "ä½ æ˜¯ä¸€ä¸ª{è§’è‰²}ï¼Œå…·æœ‰{ç‰¹å¾}çš„ç‰¹ç‚¹ã€‚è¯·ä»¥{è§’è‰²}çš„èº«ä»½å›ç­”é—®é¢˜ï¼Œä¿æŒ{è¯­è¨€é£æ ¼}çš„è¯­è¨€é£æ ¼ã€‚",
echo     "createdAt": "2024-01-01T00:00:00.000Z",
echo     "updatedAt": "2024-01-01T00:00:00.000Z"
echo   },
echo   {
echo     "id": "sample002", 
echo     "name": "åˆ›æ„å†™ä½œå…¬å¼",
echo     "content": "è¯·åˆ›ä½œä¸€ä¸ªå…³äº{ä¸»é¢˜}çš„{æ–‡ä½“}ï¼Œè¦æ±‚ï¼š\n1. é£æ ¼ï¼š{é£æ ¼ç‰¹ç‚¹}\n2. é•¿åº¦ï¼š{å­—æ•°è¦æ±‚}\n3. ç›®æ ‡å—ä¼—ï¼š{å—ä¼—ç¾¤ä½“}\n4. æ ¸å¿ƒä¿¡æ¯ï¼š{æ ¸å¿ƒä¿¡æ¯}",
echo     "createdAt": "2024-01-01T00:00:00.000Z",
echo     "updatedAt": "2024-01-01T00:00:00.000Z"
echo   },
echo   {
echo     "id": "sample003",
echo     "name": "é—®é¢˜åˆ†æå…¬å¼", 
echo     "content": "è¯·åˆ†æä»¥ä¸‹é—®é¢˜ï¼š{é—®é¢˜æè¿°}\n\nåˆ†ææ¡†æ¶ï¼š\n1. é—®é¢˜å®šä¹‰ï¼š{é—®é¢˜æœ¬è´¨}\n2. å½±å“å› ç´ ï¼š{å…³é”®å› ç´ }\n3. è§£å†³æ–¹æ¡ˆï¼š{è§£å†³æ€è·¯}\n4. å®æ–½å»ºè®®ï¼š{å…·ä½“å»ºè®®}",
echo     "createdAt": "2024-01-01T00:00:00.000Z",
echo     "updatedAt": "2024-01-01T00:00:00.000Z"
echo   }
echo ]
) > app\backend\data\init-data.json

REM åˆ›å»º app/backend/data/default-settings.json
(
echo {
echo   "app": {
echo     "name": "å–µå’’Â·AI Spellbook",
echo     "version": "1.0.0",
echo     "description": "ä»¥è¡¨è¾¾å…¬å¼çš„å½¢å¼ç»„åˆå…³é”®è¯å¥ç‰‡æ®µï¼Œå½¢æˆæ›´å¥½çš„æç¤ºè¯"
echo   },
echo   "database": {
echo     "host": "mysql.cloud.lazycat.app.aispellbook.lzcapp",
echo     "port": 3306,
echo     "database": "LAZYCAT",
echo     "user": "LAZYCAT",
echo     "password": "LAZYCAT"
echo   },
echo   "server": {
echo     "port": 3000,
echo     "cors": true,
echo     "bodyLimit": "10mb"
echo   },
echo   "features": {
echo     "autoSave": true,
echo     "backup": true,
echo     "export": true,
echo     "import": true
echo   }
echo }
) > app\backend\data\default-settings.json

REM åˆ›å»º app/backend/utils/fileHandler.js
(
echo /**
echo  * æ–‡ä»¶å¤„ç†å·¥å…·
echo  */
echo.
echo const fs = require('fs'^).promises;
echo const path = require('path'^);
echo.
echo // æ•°æ®ç›®å½•è·¯å¾„
echo const DATA_DIR = path.join(__dirname, '../data'^);
echo.
echo /**
echo  * ç¡®ä¿æ•°æ®ç›®å½•å­˜åœ¨
echo  */
echo async function ensureDataDir(^) {
echo     try {
echo         await fs.access(DATA_DIR^);
echo     } catch (error^) {
echo         await fs.mkdir(DATA_DIR, { recursive: true }^);
echo     }
echo }
echo.
echo /**
echo  * è¯»å–JSONæ–‡ä»¶
echo  * @param {string} filename - æ–‡ä»¶å
echo  * @param {any} defaultValue - é»˜è®¤å€¼
echo  * @returns {Promise^<any^>} æ–‡ä»¶å†…å®¹
echo  */
echo async function readFile(filename, defaultValue = null^) {
echo     try {
echo         await ensureDataDir(^);
echo         const filePath = path.join(DATA_DIR, filename^);
echo         const data = await fs.readFile(filePath, 'utf8'^);
echo         return JSON.parse(data^);
echo     } catch (error^) {
echo         if (error.code === 'ENOENT'^) {
echo             // æ–‡ä»¶ä¸å­˜åœ¨ï¼Œè¿”å›é»˜è®¤å€¼
echo             return defaultValue;
echo         }
echo         throw error;
echo     }
echo }
echo.
echo /**
echo  * å†™å…¥JSONæ–‡ä»¶
echo  * @param {string} filename - æ–‡ä»¶å
echo  * @param {any} data - è¦å†™å…¥çš„æ•°æ®
echo  */
echo async function writeFile(filename, data^) {
echo     try {
echo         await ensureDataDir(^);
echo         const filePath = path.join(DATA_DIR, filename^);
echo         const jsonData = JSON.stringify(data, null, 2^);
echo         await fs.writeFile(filePath, jsonData, 'utf8'^);
echo     } catch (error^) {
echo         console.error(`å†™å…¥æ–‡ä»¶ ${filename} å¤±è´¥:`, error^);
echo         throw error;
echo     }
echo }
echo.
echo /**
echo  * æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
echo  * @param {string} filename - æ–‡ä»¶å
echo  * @returns {Promise^<boolean^>} æ˜¯å¦å­˜åœ¨
echo  */
echo async function fileExists(filename^) {
echo     try {
echo         const filePath = path.join(DATA_DIR, filename^);
echo         await fs.access(filePath^);
echo         return true;
echo     } catch (error^) {
echo         return false;
echo     }
echo }
echo.
echo /**
echo  * åˆ é™¤æ–‡ä»¶
echo  * @param {string} filename - æ–‡ä»¶å
echo  */
echo async function deleteFile(filename^) {
echo     try {
echo         const filePath = path.join(DATA_DIR, filename^);
echo         await fs.unlink(filePath^);
echo     } catch (error^) {
echo         if (error.code !== 'ENOENT'^) {
echo             throw error;
echo         }
echo     }
echo }
echo.
echo /**
echo  * å¤‡ä»½æ–‡ä»¶
echo  * @param {string} filename - æ–‡ä»¶å
echo  */
echo async function backupFile(filename^) {
echo     try {
echo         const filePath = path.join(DATA_DIR, filename^);
echo         const backupPath = path.join(DATA_DIR, `${filename}.backup.${Date.now(^)^}`^);
echo         await fs.copyFile(filePath, backupPath^);
echo         return backupPath;
echo     } catch (error^) {
echo         console.error(`å¤‡ä»½æ–‡ä»¶ ${filename} å¤±è´¥:`, error^);
echo         throw error;
echo     }
echo }
echo.
echo module.exports = {
echo     readFile,
echo     writeFile,
echo     fileExists,
echo     deleteFile,
echo     backupFile
echo };
) > app\backend\utils\fileHandler.js

REM åˆ›å»º app/backend/utils/dataValidator.js
(
echo /**
echo  * æ•°æ®éªŒè¯å·¥å…·
echo  */
echo.
echo /**
echo  * éªŒè¯æ•°æ®
echo  * @param {object} data - è¦éªŒè¯çš„æ•°æ®
echo  * @param {object} rules - éªŒè¯è§„åˆ™
echo  * @returns {object} éªŒè¯ç»“æœ
echo  */
echo function validateData(data, rules^) {
echo     const errors = [];
echo     let isValid = true;
echo.
echo     for (const [field, rule] of Object.entries(rules^)^) {
echo         const value = data[field];
echo.
echo         // å¿…å¡«éªŒè¯
echo         if (rule.required ^&^& (value === undefined ^|^| value === null ^|^| value === ''^)^) {
echo             errors.push(`${field} æ˜¯å¿…å¡«å­—æ®µ`^);
echo             isValid = false;
echo             continue;
echo         }
echo.
echo         // å¦‚æœå­—æ®µä¸ºç©ºä¸”ä¸æ˜¯å¿…å¡«ï¼Œè·³è¿‡å…¶ä»–éªŒè¯
echo         if (value === undefined ^|^| value === null ^|^| value === ''^) {
echo             continue;
echo         }
echo.
echo         // ç±»å‹éªŒè¯
echo         if (rule.type^) {
echo             if (!validateType(value, rule.type^)^) {
echo                 errors.push(`${field} ç±»å‹é”™è¯¯ï¼ŒæœŸæœ› ${rule.type}`^);
echo                 isValid = false;
echo                 continue;
echo             }
echo         }
echo.
echo         // å­—ç¬¦ä¸²é•¿åº¦éªŒè¯
echo         if (rule.type === 'string'^) {
echo             if (rule.minLength ^&^& value.length ^< rule.minLength^) {
echo                 errors.push(`${field} é•¿åº¦ä¸èƒ½å°‘äº ${rule.minLength} ä¸ªå­—ç¬¦`^);
echo                 isValid = false;
echo             }
echo             if (rule.maxLength ^&^& value.length ^> rule.maxLength^) {
echo                 errors.push(`${field} é•¿åº¦ä¸èƒ½è¶…è¿‡ ${rule.maxLength} ä¸ªå­—ç¬¦`^);
echo                 isValid = false;
echo             }
echo         }
echo.
echo         // æ•°å­—èŒƒå›´éªŒè¯
echo         if (rule.type === 'number'^) {
echo             if (rule.min !== undefined ^&^& value ^< rule.min^) {
echo                 errors.push(`${field} ä¸èƒ½å°äº ${rule.min}`^);
echo                 isValid = false;
echo             }
echo             if (rule.max !== undefined ^&^& value ^> rule.max^) {
echo                 errors.push(`${field} ä¸èƒ½å¤§äº ${rule.max}`^);
echo                 isValid = false;
echo             }
echo         }
echo.
echo         // æ­£åˆ™è¡¨è¾¾å¼éªŒè¯
echo         if (rule.pattern ^&^& rule.type === 'string'^) {
echo             if (!rule.pattern.test(value^)^) {
echo                 errors.push(`${field} æ ¼å¼ä¸æ­£ç¡®`^);
echo                 isValid = false;
echo             }
echo         }
echo.
echo         // æšä¸¾å€¼éªŒè¯
echo         if (rule.enum ^&^& !rule.enum.includes(value^)^) {
echo             errors.push(`${field} å¿…é¡»æ˜¯ä»¥ä¸‹å€¼ä¹‹ä¸€: ${rule.enum.join(', '^)^}`^);
echo             isValid = false;
echo         }
echo.
echo         // è‡ªå®šä¹‰éªŒè¯å‡½æ•°
echo         if (rule.validator ^&^& typeof rule.validator === 'function'^) {
echo             const customResult = rule.validator(value^);
echo             if (customResult !== true^) {
echo                 errors.push(customResult ^|^| `${field} éªŒè¯å¤±è´¥`^);
echo                 isValid = false;
echo             }
echo         }
echo     }
echo.
echo     return {
echo         isValid,
echo         errors
echo     };
echo }
echo.
echo /**
echo  * éªŒè¯æ•°æ®ç±»å‹
echo  * @param {any} value - è¦éªŒè¯çš„å€¼
echo  * @param {string} type - æœŸæœ›çš„ç±»å‹
echo  * @returns {boolean} æ˜¯å¦åŒ¹é…ç±»å‹
echo  */
echo function validateType(value, type^) {
echo     switch (type^) {
echo         case 'string':
echo             return typeof value === 'string';
echo         case 'number':
echo             return typeof value === 'number' ^&^& !isNaN(value^);
echo         case 'boolean':
echo             return typeof value === 'boolean';
echo         case 'array':
echo             return Array.isArray(value^);
echo         case 'object':
echo             return typeof value === 'object' ^&^& value !== null ^&^& !Array.isArray(value^);
echo         case 'email':
echo             return typeof value === 'string' ^&^& /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value^);
echo         case 'url':
echo             try {
echo                 new URL(value^);
echo                 return true;
echo             } catch {
echo                 return false;
echo             }
echo         case 'date':
echo             return value instanceof Date ^|^| !isNaN(Date.parse(value^)^);
echo         default:
echo             return true;
echo     }
echo }
echo.
echo /**
echo  * æ¸…ç†å’Œæ ‡å‡†åŒ–æ•°æ®
echo  * @param {object} data - è¦æ¸…ç†çš„æ•°æ®
echo  * @param {object} rules - æ¸…ç†è§„åˆ™
echo  * @returns {object} æ¸…ç†åçš„æ•°æ®
echo  */
echo function sanitizeData(data, rules^) {
echo     const sanitized = {};
echo.
echo     for (const [field, rule] of Object.entries(rules^)^) {
echo         let value = data[field];
echo.
echo         if (value === undefined ^|^| value === null^) {
echo             if (rule.default !== undefined^) {
echo                 value = rule.default;
echo             } else {
echo                 continue;
echo             }
echo         }
echo.
echo         // å­—ç¬¦ä¸²æ¸…ç†
echo         if (rule.type === 'string' ^&^& typeof value === 'string'^) {
echo             if (rule.trim^) {
echo                 value = value.trim(^);
echo             }
echo             if (rule.toLowerCase^) {
echo                 value = value.toLowerCase(^);
echo             }
echo             if (rule.toUpperCase^) {
echo                 value = value.toUpperCase(^);
echo             }
echo         }
echo.
echo         // æ•°å­—è½¬æ¢
echo         if (rule.type === 'number' ^&^& typeof value === 'string'^) {
echo             const num = parseFloat(value^);
echo             if (!isNaN(num^)^) {
echo                 value = num;
echo             }
echo         }
echo.
echo         sanitized[field] = value;
echo     }
echo.
echo     return sanitized;
echo }
echo.
echo module.exports = {
echo     validateData,
echo     validateType,
echo     sanitizeData
echo };
) > app\backend\utils\dataValidator.js

REM åˆ›å»º app/backend/package.json
(
echo {
echo   "name": "aispellbook-backend",
echo   "version": "1.0.0",
echo   "description": "å–µå’’Â·AI Spellbook åç«¯æœåŠ¡",
echo   "main": "server.js",
echo   "scripts": {
echo     "start": "node server.js",
echo     "dev": "nodemon server.js",
echo     "test": "echo \"Error: no test specified\" && exit 1"
echo   },
echo   "keywords": [
echo     "ai",
echo     "spellbook",
echo     "prompt",
echo     "lazycat"
echo   ],
echo   "author": "LazyCAT Team",
echo   "license": "MIT",
echo   "dependencies": {
echo     "express": "^4.18.2",
echo     "cors": "^2.8.5"
echo   },
echo   "devDependencies": {
echo     "nodemon": "^3.0.1"
echo   },
echo   "engines": {
echo     "node": "^>=16.0.0"
echo   }
echo }
) > app\backend\package.json

REM åˆ›å»º app/config/database.js
(
echo /**
echo  * æ•°æ®åº“é…ç½®æ–‡ä»¶
echo  */
echo.
echo module.exports = {
echo   // æ‡’çŒ«å¾®æœ MySQL æ•°æ®åº“é…ç½®
echo   mysql: {
echo     host: 'mysql.cloud.lazycat.app.aispellbook.lzcapp',
echo     port: 3306,
echo     user: 'LAZYCAT',
echo     password: 'LAZYCAT',
echo     database: 'LAZYCAT',
echo     charset: 'utf8mb4',
echo     timezone: '+08:00',
echo     acquireTimeout: 60000,
echo     timeout: 60000,
echo     reconnect: true,
echo     pool: {
echo       min: 0,
echo       max: 10,
echo       acquire: 30000,
echo       idle: 10000
echo     }
echo   },
echo.
echo   // å¼€å‘ç¯å¢ƒé…ç½®
echo   development: {
echo     host: 'localhost',
echo     port: 3306,
echo     user: 'root',
echo     password: '',
echo     database: 'aispellbook_dev'
echo   },
echo.
echo   // æµ‹è¯•ç¯å¢ƒé…ç½®
echo   test: {
echo     host: 'localhost',
echo     port: 3306,
echo     user: 'root',
echo     password: '',
echo     database: 'aispellbook_test'
echo   }
echo };
) > app\config\database.js

echo.
echo âœ… å–µå’’Â·AI Spellbook é¡¹ç›®ç»“æ„åˆ›å»ºå®Œæˆï¼
echo.
echo ğŸ“ é¡¹ç›®ç›®å½•: pormula/
echo ğŸŒ å‰ç«¯æ–‡ä»¶: app/web/
echo âš™ï¸ åç«¯æœåŠ¡: app/backend/
echo ğŸ“‹ é…ç½®æ–‡ä»¶: lzc-build.yml, lzc-manifest.yml
echo.
echo ğŸš€ ä¸‹ä¸€æ­¥æ“ä½œ:
echo 1. cd pormula
echo 2. cd app/backend ^&^& npm install
echo 3. ä½¿ç”¨ lzc-cli è¿›è¡Œå¼€å‘å’Œéƒ¨ç½²
echo.
echo ğŸ‰ é¡¹ç›®åˆ›å»ºæˆåŠŸï¼å¼€å§‹æ‚¨çš„ AI æç¤ºè¯å…¬å¼ä¹‹æ—…å§ï¼

cd ..
pause